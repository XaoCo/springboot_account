<!doctype html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>找回密码</title>
    <script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <style>
        @charset "utf-8";
        /* track base Css */
        .bg {
            background-image: url("/images/bg2.jpg");
        }

        .container {
            margin-top: 50px;
        }

        .red {
            color: red;
        }

        #ehong-code-input {
            width: 42px;
            letter-spacing: 2px;
            margin: 0px 8px 0px 0px;
        }

        .ehong-idcode-val {
            position: relative;
            padding: 1px 4px 1px 4px;
            top: 0px;
            *top: -3px;
            letter-spacing: 4px;
            display: inline;
            cursor: pointer;
            font-size: 16px;
            font-family: "Courier New", Courier, monospace;
            text-decoration: none;
            font-weight: bold;
        }

        .ehong-idcode-val0 {
            border: solid 1px #A4CDED;
            background-color: #ECFAFB;
        }

        .ehong-idcode-val1 {
            border: solid 1px #A4CDED;
            background-color: #FCEFCF;
        }

        .ehong-idcode-val2 {
            border: solid 1px #6C9;
            background-color: #D0F0DF;
        }

        .ehong-idcode-val3 {
            border: solid 1px #6C9;
            background-color: #DCDDD8;
        }

        .ehong-idcode-val4 {
            border: solid 1px #6C9;
            background-color: #F1DEFF;
        }

        .ehong-idcode-val5 {
            border: solid 1px #6C9;
            background-color: #ACE1F1;
        }

        .ehong-code-val-tip {
            font-size: 12px;
            color: #1098EC;
            top: 0px;
            *top: -3px;
            position: relative;
            margin: 0px 0px 0px 4px;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="../../js/bootbox.js"></script>
<div class="container">
    <div class="col-md-4 col-md-offset-4">
        <div style="width: 420px;height: 400px;background-color: white;padding: 20px 40px 40px 40px">
            <div align="center">
                <img src="/images/login_afe3eb0.png" height="64" width="64"/>
            </div>
            <form action="/user/findPwd" enctype="multipart/form-data" method="post" id="findPwdForm">
                <p style="color: red" th:text="${msg4}" th:if="${not #strings.isEmpty(msg4)}"></p>

                <div class="form-group has-feedback">
                    <label for="username"></label>
                    <div class="input-group">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                        <input id="username" name="username" class="form-control" placeholder="用户名" maxlength="20"
                               type="text" onkeyup="checkName()">
                    </div>

                    <span style="color:red;display: none;" class="tips"></span>
                    <span style="display: none;" class=" glyphicon glyphicon-remove form-control-feedback"></span>
                    <span style="display: none;" class="glyphicon glyphicon-ok form-control-feedback"></span>
                </div>

                <div class="form-group has-feedback">
                    <label for="password"></label>
                    <div class="input-group">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
                        <input id="password" name="password" class="form-control" placeholder="密码" maxlength="20"
                               type="password">
                    </div>

                    <span style="color:red;display: none;" class="tips"></span>
                    <span style="display: none;" class="glyphicon glyphicon-remove form-control-feedback"></span>
                    <span style="display: none;" class="glyphicon glyphicon-ok form-control-feedback"></span>
                </div>

                <div class="form-group has-feedback">
                    <label for="passwordConfirm"></label>
                    <div class="input-group">
                        <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
                        <input id="passwordConfirm" class="form-control" placeholder="请再次输入密码"
                               maxlength="20" type="password">
                    </div>
                    <span style="color:red;display: none;" class="tips"></span>
                    <span style="display: none;" class="glyphicon glyphicon-remove form-control-feedback"></span>
                    <span style="display: none;" class="glyphicon glyphicon-ok form-control-feedback"></span>
                </div>


                <div class="row form-group">
                    <div class="col-xs-12">
                        <input class="form-control btn btn-primary"
                               value="提&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;交" id="tijiao"
                               type="button" onclick="findPwd()">
                    </div>
                </div>

                <div class="form-group">
                    <input value="重&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;置"
                           id="reset" class="form-control btn btn-danger" type="reset">
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    var settings = {
        e: 'idcode',
        codeType: {
            name: 'follow',
            len: 4
        }, //len是修改验证码长度的
        codeTip: '换个验证码?',
        inputID: 'idcode-btn' //验证元素的ID
    };

    var _set = {
        storeLable: 'codeval',
        store: '#ehong-code-input',
        codeval: '#ehong-code'
    }
    $.idcode = {
        getCode: function (option) {
            _commSetting(option);
            return _storeData(_set.storeLable, null);
        },
        setCode: function (option) {
            _commSetting(option);
            _setCodeStyle("#" + settings.e, settings.codeType.name, settings.codeType.len);

        },
        validateCode: function (option) {
            _commSetting(option);
            var inputV;
            if (settings.inputID) {
                inputV = $('#' + settings.inputID).val();

            } else {
                inputV = $(_set.store).val();
            }
            if (inputV.toUpperCase() == _storeData(_set.storeLable, null).toUpperCase()) { //修改的不区分大小写
                return true;
            } else {
                _setCodeStyle("#" + settings.e, settings.codeType.name, settings.codeType.len);
                return false;
            }
        }
    };

    function _commSetting(option) {
        $.extend(settings, option);
    }

    function _storeData(dataLabel, data) {
        var store = $(_set.codeval).get(0);
        if (data) {
            $.data(store, dataLabel, data);
        } else {
            return $.data(store, dataLabel);
        }
    }

    function _setCodeStyle(eid, codeType, codeLength) {
        var codeObj = _createCode(settings.codeType.name, settings.codeType.len);
        var randNum = Math.floor(Math.random() * 6);
        var htmlCode = ''
        if (!settings.inputID) {
            htmlCode = '<span><input id="ehong-code-input" type="text" maxlength="4" /></span>';
        }
        htmlCode += '<div id="ehong-code" class="ehong-idcode-val ehong-idcode-val';
        htmlCode += String(randNum);
        htmlCode += '" href="#" onblur="return false" onfocus="return false" oncontextmenu="return false" onclick="$.idcode.setCode()">' + _setStyle(codeObj) + '</div>' + '<span id="ehong-code-tip-ck" class="ehong-code-val-tip" onclick="$.idcode.setCode()">' + settings.codeTip + '</span>';
        $(eid).html(htmlCode);
        _storeData(_set.storeLable, codeObj);
    }

    function _setStyle(codeObj) {
        var fnCodeObj = new Array();
        var col = new Array('#BF0C43', '#E69A2A', '#707F02', '#18975F', '#BC3087', '#73C841', '#780320', '#90719B', '#1F72D8', '#D6A03C', '#6B486E', '#243F5F', '#16BDB5');
        var charIndex;
        for (var i = 0; i < codeObj.length; i++) {
            charIndex = Math.floor(Math.random() * col.length);
            fnCodeObj.push('<font color="' + col[charIndex] + '">' + codeObj.charAt(i) + '</font>');
        }
        return fnCodeObj.join('');
    }

    function _createCode(codeType, codeLength) {
        var codeObj;
        if (codeType == 'follow') {
            codeObj = _createCodeFollow(codeLength);
        } else if (codeType == 'calc') {
            codeObj = _createCodeCalc(codeLength);
        } else {
            codeObj = "";
        }
        return codeObj;
    }

    function _createCodeCalc(codeLength) {
        var code1, code2, codeResult;
        var selectChar = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9');
        var charIndex;
        for (var i = 0; i < codeLength; i++) {
            charIndex = Math.floor(Math.random() * selectChar.length);
            code1 += selectChar[charIndex];

            charIndex = Math.floor(Math.random() * selectChar.length);
            code2 += selectChar[charIndex];
        }
        return [parseInt(code1), parseInt(code2), parseInt(code1) + parseInt(code2)];
    }

    function _createCodeFollow(codeLength) {
        var code = "";
        var selectChar = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');

        for (var i = 0; i < codeLength; i++) {
            var charIndex = Math.floor(Math.random() * selectChar.length);
            if (charIndex % 2 == 0) {
                code += selectChar[charIndex].toLowerCase();
            } else {
                code += selectChar[charIndex];
            }
        }
        return code;
    }

    var regUsername = /^[a-zA-Z_][a-zA-Z0-9_]{4,19}$/;
    var regPasswordSpecial = /[~!@#%&=;':",./<>_\}\]\-\$\(\)\*\+\.\[\?\\\^\{\|]/;
    var regPasswordAlpha = /[a-zA-Z]/;
    var regPasswordNum = /[0-9]/;
    var password;
    var check = [false, false, false];

    //校验成功函数
    function success(Obj, counter) {
        Obj.parent().parent().removeClass('has-error').addClass('has-success');
        $('.tips').eq(counter).hide();
        $('.glyphicon-ok').eq(counter).show();
        $('.glyphicon-remove').eq(counter).hide();
        check[counter] = true;

    }

    // 校验失败函数
    function fail(Obj, counter, msg) {
        Obj.parent().parent().removeClass('has-success').addClass('has-error');
        $('.glyphicon-remove').eq(counter).show();
        $('.glyphicon-ok').eq(counter).hide();
        $('.tips').eq(counter).text(msg).show();
        check[counter] = false;
    }

    // 用户名匹配
    $('.container').find('input').eq(0).change(function () {

        console.log("name=" + $(this).val())
        if (regUsername.test($(this).val())) {
            success($(this), 0);
        } else if ($(this).val().length < 5) {
            fail($(this), 0, '用户名太短，不能少于5个字符');
        } else {
            fail($(this), 0, '用户名只能为英文数字和下划线,且不能以数字开头')
        }

    });


    // 密码匹配

    // 匹配字母、数字、特殊字符至少两种的函数
    function atLeastTwo(password) {
        var a = regPasswordSpecial.test(password) ? 1 : 0;
        var b = regPasswordAlpha.test(password) ? 1 : 0;
        var c = regPasswordNum.test(password) ? 1 : 0;
        return a + b + c;

    }

    $('.container').find('input').eq(1).change(function () {

        password = $(this).val();
        console.log("密码=" + password)

        if ($(this).val().length < 8) {
            fail($(this), 1, '密码太短，不能少于8个字符');
        } else {


            if (atLeastTwo($(this).val()) < 2) {
                fail($(this), 1, '密码中至少包含字母、数字、特殊字符的两种')
            } else {
                success($(this), 1);
            }
        }
    });


    // 再次输入密码校验
    $('.container').find('input').eq(2).change(function () {
        console.log("校验密码=" + $(this).val())
        if ($(this).val() == password) {
            success($(this), 2);
        } else {

            fail($(this), 2, '两次输入的密码不一致');
        }

    });


    // // 验证码
    // $.idcode.setCode();
    //
    // $('.container').find('input').eq(2).change(function () {
    //     var IsBy = $.idcode.validateCode();
    //     if (IsBy) {
    //         success($(this), 2);
    //     } else {
    //         fail($(this), 2, '验证码输入错误');
    //     }
    // });

    // 手机号码
    // var regPhoneNum = /^[0-9]{11}$/
    // $('.container').find('input').eq(4).change(function () {
    //     if (regPhoneNum.test($(this).val())) {
    //         success($(this), 4);
    //     } else {
    //         fail($(this), 4, '手机号码只能为11位数字');
    //     }
    // });
    //
    // //短信验证码
    // var regMsg = /111111/;
    // $('.container').find('input').eq(5).change(function () {
    //     if (check[4]) {
    //         if (regMsg.test($(this).val())) {
    //             success($(this), 5);
    //         } else {
    //             fail($(this), 5, '短信验证码错误');
    //         }
    //     } else {
    //         $('.container').find('input').eq(4).parent().parent().removeClass('has-success').addClass('has-error');
    //     }
    //
    // });


    // $('#loadingButton').click(function () {
    //
    //     if (check[4]) {
    //         $(this).removeClass('btn-primary').addClass('disabled');
    //
    //         $(this).html('<span class="red">59</span> 秒后重新获取');
    //         var secondObj = $('#loadingButton').find('span');
    //         var secondObjVal = secondObj.text();
    //
    //         function secondCounter() {
    //
    //             var secondTimer = setTimeout(function () {
    //                 secondObjVal--;
    //                 secondObj.text(secondObjVal);
    //                 secondCounter();
    //             }, 1000);
    //             if (secondObjVal == 0) {
    //                 clearTimeout(secondTimer);
    //                 $('#loadingButton').text('重新获取校验码');
    //                 $('#loadingButton').removeClass('disabled').addClass('btn-primary');
    //
    //             }
    //         }
    //
    //         secondCounter();
    //     } else {
    //         $('.container').find('input').eq(4).parent().parent().removeClass('has-success').addClass('has-error');
    //     }
    //
    // })

    $('#tijiao').click(function (e) {
        if (!check.every(function (value) {
            return value == true
        })) {
            e.preventDefault();
            for (key in check) {
                if (!check[key]) {
                    $('.container').find('input').eq(key).parent().parent().removeClass('has-success').addClass('has-error')
                }
            }
        }
    });

    $('#reset').click(function () {
        $('input').slice(0, 6).parent().parent().removeClass('has-error has-success');
        $('.tips').hide();
        $('.glyphicon-ok').hide();
        $('.glyphicon-remove').hide();
        check = [false, false, false, false, false, false,];
    });

    function checkName() {
        $.ajax({
            url: "/user/findByName",
            data: $("#findPwdForm").serialize(),
            success: function (data) {
                if (data == 0) {
                    bootbox.alert({
                        message: '该用户还未注册过，不能重置密码，请先进行注册！',
                        size: 'small',
                        callback: function () {
                            window.location.href = '/user/registerpage';
                        },
                    });
                }
            }
        })
    }


    function findPwd() {
        $.ajax({
            url: "/user/findPwd",
            data: $("#findPwdForm").serialize(),
            success: function (data) {
                if (data == 1) {
                    bootbox.alert({
                        message: '重置密码成功，请登录！',
                        size: 'small',
                        callback: function () {
                            window.location.href = '/user/loginHtml'
                        }
                    })
                } else if (data == -1) {
                    bootbox.alert({
                        message: '重置密码失败,请检查信息！',
                        size: 'small',
                        callback: function () {
                            window.location.href = '/user/findPwdPage'
                        }
                    })
                } else if (data == -2) {
                    bootbox.alert({
                        message: '姓名或者密码为空！',
                        size: 'small',
                        callback: function () {
                            window.location.href = '/user/findPwdPage'
                        }
                    })
                } else {
                    bootbox.alert({
                        message: '该姓名还未注册过，请先注册！',
                        size: 'small',
                        callback: function () {
                            window.location.href = '/user/registerpage'
                        }
                    })
                }
            }
        })
    }
</script>

</body>
</html>


<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.springframework.org/schema/data/jaxb">-->
<!--<head>-->
<!--&lt;!&ndash; meta &ndash;&gt;-->
<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>-->
<!--<meta name="renderer" content="webkit">-->
<!--<meta property="qc:admins" content="23635710066417756375"/>-->
<!--<meta name="baidu-site-verification" content="QIQ6KC1oZ6"/>-->
<!--<meta charset="UTF-8">-->

<!--<title>找回密码</title>-->

<!--<link rel="stylesheet" th:href="@{/css/dmaku2.css}" href="../../static/css/dmaku2.css">-->
<!--&lt;!&ndash;<link rel="stylesheet" th:href="@{/css/dmaku.css}" href="../../static/css/dmaku.css">&ndash;&gt;-->
<!--<script th:src="@{/js/jquery-1.12.3.min.js}" src="../../static/js/jquery-1.12.3.min.js"></script>-->
<!--<script th:src="@{/js/pintuer.js}" src="../../static/js/pintuer.js"></script>-->
<!--<link rel="stylesheet" th:href="@{/css/admin.css}" href="../../static/css/admin.css">-->
<!--<link rel="stylesheet" th:href="@{/css/pintuer.css}" href="../../static/css/pintuer.css">-->
<!--</head>-->

<!--<body class="image1">-->
<!--<style>-->
<!--.image1 {-->
<!--background-image: url(/images/bg_cb3e28c.jpg);-->
<!--}-->

<!--.image2 {-->
<!--width: 450px;-->
<!--}-->
<!--</style>-->


<!--&lt;!&ndash; 页面主体START &ndash;&gt;-->


<!--<section id="main" class="image2">-->
<!--<h1>找回密码</h1>-->
<!--<form action="/user/findPwd" accept-charset="utf-8" data-view="phoneRegister">-->


<!--<p style="color: red" th:text="${msg4}" th:if="${not #strings.isEmpty(msg4)}"></p>-->
<!--<div class="form-group" data-propertyname="username" data-controltype="Phone">-->
<!--&lt;!&ndash; <input type="text" class="field" placeholder="输入姓名" id="user_name" name="username"  data-validate="required:请输入姓名" autocomplete="off" >&ndash;&gt;-->
<!--<div class="field">-->
<!--<input type="text" class="input input-big" name="username" placeholder="输入姓名"-->
<!--data-validate="required:请填写姓名"/>-->
<!--</div>-->
<!--</div>-->

<!--<div class="form-group" data-propertyname="password" data-controltype="Password">-->
<!--<div class="field">-->
<!--<input type="password" class="input input-big" id="identityCard" name="identityCard" placeholder="输入身份证"-->
<!--data-validate="required:请输入身份证,length#==18:身份证位数为18位">-->
<!--</div>-->
<!--</div>-->

<!--<div class="form-group" data-propertyname="password" data-controltype="Password">-->
<!--<div class="field">-->
<!--<input type="password" class="input input-big" id="password" name="password" placeholder="输入密码"-->
<!--data-validate="required:请输入密码,length#>=6:密码不能小于6位">-->
<!--</div>-->
<!--</div>-->

<!--<div class="form-group" data-propertyname="password" data-controltype="Password">-->
<!--<div class="field">-->
<!--<input type="password" class="input input-big" id="passwordnew" name="passwordnew" placeholder="确认密码"-->
<!--data-validate="required:请确认密码,length#>=6:密码不能小于6位,repeat#password:两次输入的密码不一致">-->
<!--</div>-->
<!--</div>-->


<!--<div class="clearfix btn_login" data-propertyname="submit" data-controltype="Botton">-->
<!--<input type="submit" value="重置">-->
<!--</div>-->


<!--</form>-->
<!--</section>-->

<!--&lt;!&ndash; 页面主体END &ndash;&gt;-->


<!--</body>-->
<!--</html>-->
